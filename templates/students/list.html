{% extends 'base.html' %}

{% block title %}Students List{% endblock %}

{% block content %}

<div class="d-flex justify-content-between align-items-center mb-4">
    <h2>Students 
        {% if filter_type == 'active' %}(Active)
        {% elif filter_type == 'inactive' %}(Inactive)
        {% elif filter_type == 'expiring' %}(Expiring Soon)
        {% elif filter_type == 'reserved' %}(Reserved)
        {% elif filter_type == 'non_reserved' %}(Non-Reserved)
        {% else %}(All)
        {% endif %}
    </h2>
    <div>
        <a href="{% url 'student_create' %}" class="btn btn-primary me-2">
            <i class="fas fa-plus me-2"></i>Add Student
        </a>
        <a href="{% url 'export_students_csv' %}?{{ query_string }}" class="btn btn-success">
            <i class="fas fa-download me-2"></i>Export CSV
        </a>
    </div>
</div>
<form method="get" action="{% url 'students_list' %}" class="mb-3 d-flex">
    <input type="text" name="q" value="{{ search_query }}" class="form-control me-2" placeholder="Search students...">
    <input type="hidden" name="filter" value="{{ filter_type }}">
    <h6>Filter By Study Hours</h6>
    <select name="hours" class="form-control me-2" style="width: 150px;" onchange="this.form.submit()">
        <option value="" {% if not hours_filter %}selected{% endif %}>All Hours</option>
        {% for hour, label in hour_choices %}
            <option value="{{ hour }}" {% if hours_filter == hour %}selected{% endif %}>{{ label }}</option>
        {% endfor %}
    </select>
    <button type="submit" class="btn btn-primary">Search</button>
</form>

<div class="card">
    <div class="card-body">
        {% if students %}
        <div class="table-responsive">
            <table class="table table-hover" style="table-layout: fixed; width: 100%;">
                <thead class="table-dark">
                    <tr>
                        <th style="width: 5%;">ID</th>
                        <th style="width: 15%;">Name</th>
                        <th style="width: 10%;">Photo</th>
                        <th style="width: 15%;">Mobile</th>
                        <th style="width: 7%;">Status</th>
                        <th style="width: 10%;">Date Added</th>
                        <th style="width: 15%;">Actions</th>
                    </tr>
                </thead>
                <tbody>
                    {% for student in students %}
                    <tr>
                        <td style="word-wrap: break-word;">
                            <strong>{{ student.id }}</strong><br>
                        </td>
                        <td style="word-wrap: break-word;">
                            <strong>{{ student.name }}</strong><br>
                            <small class="text-muted">{{ student.aadhaar_number }}</small>
                        </td>
                        <td>
                            {% if student.photo %}
                                <img src="{{ student.photo.url }}" alt="{{ student.name }}'s photo" class="rounded-circle" style="width: 40px; height: 40px; object-fit: cover;">
                            {% else %}
                                <img src="/media/student_photos/user.jpg" alt="Default avatar" class="rounded-circle" style="width: 40px; height: 40px; object-fit: cover;">
                            {% endif %}
                        </td>
                        <td style="word-wrap: break-word;">{{ student.mobile }}</td>
                        <td>
                            <span class="badge {% if student.status == 'Active' %}bg-success{% elif student.status == 'Inactive' %}bg-danger{% else %}bg-warning{% endif %}">
                                {{ student.status }}
                            </span>
                        </td>
                        <td style="word-wrap: break-word;">{{ student.created_at|date:"M d, Y" }}</td>
                        <td>
                            <a href="{% url 'student_detail' student.id %}" class="btn btn-sm btn-info me-1">
                                <i class="fas fa-eye"></i> View
                            </a>
                            <a href="{% url 'student_update' student.id %}" class="btn btn-sm btn-warning me-1">
                                <i class="fas fa-edit"></i> Edit
                            </a>
                            <a href="{% url 'student_delete' student.id %}" class="btn btn-sm btn-danger">
                                <i class="fas fa-trash"></i> Delete
                            </a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
        <!-- Pagination -->
        {% if students.has_other_pages %}
       <nav aria-label="Students pagination">
  <ul class="pagination justify-content-center">
    {% if students.has_previous %}
      <li class="page-item">
        <a class="page-link" href="?page={{ students.previous_page_number }}&{{ query_string }}">Previous</a>
      </li>
    {% endif %}

    {% for page_num in students.paginator.page_range %}
      {% if page_num == students.number %}
        <li class="page-item active">
          <span class="page-link">{{ page_num }}</span>
        </li>
      {% else %}
        <li class="page-item">
          <a class="page-link" href="?page={{ page_num }}&{{ query_string }}">{{ page_num }}</a>
        </li>
      {% endif %}
    {% endfor %}

    {% if students.has_next %}
      <li class="page-item">
        <a class="page-link" href="?page={{ students.next_page_number }}&{{ query_string }}">Next</a>
      </li>
    {% endif %}
  </ul>
</nav>

        {% endif %}
        
        {% else %}
        <div class="text-center py-5">
            <i class="fas fa-users fa-3x text-muted mb-3"></i>
            <h4>No students found</h4>
            <p class="text-muted">Start by adding your first student to the system.</p>
            <a href="{% url 'student_create' %}" class="btn btn-primary">
                <i class="fas fa-plus me-2"></i>Add First Student
            </a>
        </div>
        {% endif %}
    </div>
</div>
{% endblock %}